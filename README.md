# cocoa-estat

日本の統計データポータルe-StatのAPIを使って、自治体の統計データを取得するコマンドラインツールです✨

## セットアップ

```bash
# 依存関係をインストール
npm install
```

## 基本的な使い方

### 1. e-Stat APIのアプリIDを取得

1. [e-Stat](https://www.e-stat.go.jp/)にアクセス
2. 「API機能」→「アプリケーションID取得」から登録
3. アプリIDを取得してください

### 2. 設定ファイルを作成

プロジェクトルートに `cocoa-estat.config.js` を作成します：

```javascript
module.exports = {
  statsData: [
    { 
      statsId: '0000020201', // 社会・人口統計体系
      cdCat01: 'A1101'       // 総人口
    },
    { 
      statsId: '0000020201', // 社会・人口統計体系
      cdCat01: 'A7101'       // 世帯数
    }
  ]
};
```

### 3. コマンド実行

```bash
# 基本的な実行
node index.js -a YOUR_APP_ID -m MUNICIPALITY_ID

# 例: 東京都千代田区（地域コード: 13101）のデータを取得
node index.js -a abcd1234efgh5678 -m 13101

# 出力先を指定
node index.js -a YOUR_APP_ID -m 13101 -o ./my-output

# 設定ファイルを指定
node index.js -a YOUR_APP_ID -m 13101 -c ./custom-config.js

# グローバルインストールした場合
cocoa-estat -a YOUR_APP_ID -m 13101
```

## 主要な自治体コード

| 自治体名 | コード |
|----------|--------|
| 東京都千代田区 | 13101 |
| 大阪市 | 27100 |
| 横浜市 | 14100 |
| 名古屋市 | 23100 |
| 福岡市 | 40130 |

詳細は[総務省の全国地方公共団体コード](https://www.soumu.go.jp/denshijiti/code.html)を参照してください。

## オプション

| オプション | 説明 | 必須 |
|------------|------|------|
| `-a, --appId <id>` | e-Stat API アプリケーションID | ✅ |
| `-m, --municipalityId <id>` | 自治体ID（地域コード） | ✅ |
| `-c, --config <file>` | 設定ファイルのパス | - |
| `-o, --output <dir>` | 出力ディレクトリ（デフォルト: `./output`） | - |
| `--latest <file>` | 最新データのみを指定ファイルに出力 | - |

## 出力ファイル

実行すると、タイムスタンプ付きのフォルダが自動作成され、以下のファイルが生成されます：

```
./output/data-20250103-143052/
├── result.json    # 取得した全データ（JSON形式）
├── latest.json    # 各統計の最新データのみ（JSON形式）
└── summary.txt    # 最新データの要約（人間が読みやすい形式）
```

## 設定ファイルの詳細

`cocoa-estat.config.js`で詳細な設定が可能です：

```javascript
module.exports = {
  // API基本設定
  lang: 'J',              // 言語（J: 日本語, E: 英語）
  metaGetFlg: 'Y',        // メタ情報取得（Y/N）
  cntGetFlg: 'N',         // 件数のみ取得（Y/N）
  
  // 統計データ設定（複数指定可能）
  statsData: [
    {
      statsId: '0000020201',     // 統計表ID
      cdCat01: 'A1101',          // カテゴリコード
      cdTimeFrom: '2020100000'   // 開始年（オプション）
    },
    {
      statsId: '0000020201',
      cdCat01: 'A7101'
    }
    // 他の統計データも追加可能
  ]
};
```

## よく使用される統計データ

| 統計名 | statsId | cdCat01 | 説明 |
|--------|---------|---------|------|
| 総人口 | 0000020201 | A1101 | 社会・人口統計体系の総人口 |
| 世帯数 | 0000020201 | A7101 | 社会・人口統計体系の世帯数 |
| 製造業事業所数 | 0000020203 | C3403 | 製造業の事業所数 |
| 病院数 | 0000020209 | I5101 | 医療機関数（病院） |
| 小学校数 | 0000020205 | E2101 | 教育機関数（小学校） |

## 実行例

```bash
$ node index.js -a myapp123 -m 13101

e-Stat APIの準備をしています...✨
アプリID: myapp123
自治体ID: 13101
取得する統計データ数: 2件

統計データID「0000020201」の取得を開始します...✨
APIリクエスト送信中...💌
✅ カテゴリー「Ａ　人口・世帯」のデータを取得しました！
   データ項目: A1101_総人口

📊 取得データ情報:
📈 データセット 1:
- 統計ID: 0000020201
- 統計名: 社会・人口統計体系
- 主カテゴリー: 人口・世帯
- データ件数: 45件

出力フォルダを作成しました✨: ./output/data-20250103-143052
データを ./output/data-20250103-143052/result.json に保存しました💾

✅ すべての処理が完了しました！出力フォルダ: ./output/data-20250103-143052
```

## トラブルシューティング

### エラー: 統計データが指定されていません💦

```
設定ファイル（cocoa-estat.config.js）に、取得したい統計データIDを指定してください
例: module.exports = { statsData: [{ statsId: "00200502" }] }
```

→ プロジェクトルートに設定ファイルを作成してください。

### APIエラーが発生する場合

- アプリIDが正しいか確認
- 自治体IDが正しいか確認
- statsIdとcdCat01の組み合わせが正しいか確認

## ライセンス

ISC

## 開発

このプロジェクトはNode.jsで開発されており、以下の主要ライブラリを使用しています：

- `axios` - HTTP通信
- `commander` - CLI引数解析

プルリクエストやイシューの報告をお待ちしています💖
